---
id: 01-request-format
title: 'HTTP Request Format'
order: 1
---

# HTTP Request Format

Let's examine the exact format of HTTP requests and parse them in C.

## Raw HTTP Request

When you visit `http://localhost:8080/index.html` with a browser, it sends:

```
GET /index.html HTTP/1.1\r\n
Host: localhost:8080\r\n
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36\r\n
Accept: text/html,application/xhtml+xml\r\n
Accept-Language: en-US,en\r\n
Connection: keep-alive\r\n
\r\n
```

Breaking this down:

- **Request line**: `GET /index.html HTTP/1.1`
- **Headers**: `Host: ...`, `User-Agent: ...`, etc.
- **Blank line**: `\r\n` (CRLF) marks end of headers
- **Body**: Empty (for GET request)

## Request Line Parsing

The request line contains three parts:

```c
#include <string.h>
#include <stdlib.h>

typedef struct {
    char method[16];
    char path[256];
    char version[16];
} http_request_line;

http_request_line parse_request_line(char *line) {
    http_request_line req;

    char *method = strtok(line, " ");
    char *path = strtok(NULL, " ");
    char *version = strtok(NULL, " ");

    strncpy(req.method, method ? method : "", sizeof(req.method) - 1);
    strncpy(req.path, path ? path : "", sizeof(req.path) - 1);
    strncpy(req.version, version ? version : "HTTP/1.0", sizeof(req.version) - 1);

    return req;
}
```

## Header Parsing

Headers are `Key: Value` pairs:

```c
#include <strings.h>

typedef struct {
    char host[128];
    char user_agent[256];
    char accept[256];
    char connection[32];
    // Add other headers as needed
} http_headers;

http_headers parse_headers(char *headers_start) {
    http_headers hdr = {0};
    char *line = headers_start;

    while (line && *line && *line != '\r' && *line != '\n') {
        char *colon = strchr(line, ':');
        if (colon) {
            char key[64], value[256];
            *colon = '\0';

            strncpy(key, line, sizeof(key) - 1);
            strncpy(value, colon + 2, sizeof(value) - 1);  // Skip ": "

            // Remove trailing \r if present
            size_t len = strlen(value);
            if (len > 0 && value[len - 1] == '\r') {
                value[len - 1] = '\0';
            }

            if (strcasecmp(key, "Host") == 0) {
                strncpy(hdr.host, value, sizeof(hdr.host) - 1);
            } else if (strcasecmp(key, "User-Agent") == 0) {
                strncpy(hdr.user_agent, value, sizeof(hdr.user_agent) - 1);
            }
            // Handle other headers...
        }
        line += strlen(line) + 1;  // Move to next line
    }

    return hdr;
}
```

## Complete Request Parser

```c
typedef struct {
    http_request_line request_line;
    http_headers headers;
    char *body;
    size_t body_length;
} http_request;

http_request parse_http_request(char *raw, size_t total_size) {
    http_request req = {0};

    // Find end of request line (first \r\n or \n)
    char *line_end = strstr(raw, "\r\n");
    if (!line_end) line_end = strchr(raw, '\n');
    if (!line_end) return req;

    // Parse request line (make a copy)
    size_t line_len = line_end - raw;
    char line[512];
    strncpy(line, raw, line_len);
    line[line_len] = '\0';

    req.request_line = parse_request_line(line);

    // Headers start after request line
    char *headers_start = line_end + 2;  // Skip \r\n
    req.headers = parse_headers(headers_start);

    return req;
}
```
