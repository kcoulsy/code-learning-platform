---
id: 01-parse-request-line
title: 'Parsing the Request Line'
order: 1
---

# Parsing the Request Line

The request line is the first line of an HTTP request. Let's parse it correctly.

## Request Line Format

```
METHOD PATH HTTP/VERSION
GET /index.html HTTP/1.1
POST /api/users HTTP/1.0
DELETE /files/doc.txt HTTP/1.1
```

## Safe Parsing with strspn/strcspn

```c
#include <string.h>
#include <stdlib.h>
#include <ctype.h>

int is_valid_token_char(char c) {
    return isprint((unsigned char)c) &&
           !isspace((unsigned char)c) &&
           c != '(' && c != ')' && c != '<' && c != '>' &&
           c != '@' && c != ',' && c != ';' && c != ':' &&
           c != '\\' && c != '"' && c != '/' && c != '[' &&
           c != ']' && c != '?' && c != '=' && c != '{' &&
           c != '}' && c != ' ';
}

int parse_request_line(const char *line, char *method, char *path, char *version) {
    // Skip leading whitespace
    while (isspace((unsigned char)*line)) line++;

    // Parse method
    const char *method_end = line;
    while (*method_end && !isspace((unsigned char)*method_end)) method_end++;

    if (method_end == line) return -1;
    size_t method_len = method_end - line;

    if (method_len >= 16) return -1;
    strncpy(method, line, method_len);
    method[method_len] = '\0';

    // Skip whitespace
    line = method_end;
    while (isspace((unsigned char)*line)) line++;

    // Parse path
    const char *path_end = line;
    while (*path_end && !isspace((unsigned char)*path_end)) path_end++;

    if (path_end == line) return -1;
    size_t path_len = path_end - line;

    if (path_len >= 256) return -1;
    strncpy(path, line, path_len);
    path[path_len] = '\0';

    // Skip whitespace
    line = path_end;
    while (isspace((unsigned char)*line)) line++;

    // Parse version
    size_t version_len = strlen(line);
    if (version_len == 0) return -1;
    if (version_len >= 16) return -1;
    strncpy(version, line, version_len);
    version[version_len] = '\0';

    // Validate version
    if (strncmp(version, "HTTP/", 5) != 0) return -1;

    return 0;
}
```

## URL Decoding Path

HTTP paths may be URL-encoded:

```c
#include <ctype.h>

void decode_url(char *str) {
    char *src = str;
    char *dst = str;

    while (*src) {
        if (src[0] == '%' && isxdigit((unsigned char)src[1]) && isxdigit((unsigned char)src[2])) {
            char hex[3] = {src[1], src[2], 0};
            *dst++ = (char)strtol(hex, NULL, 16);
            src += 3;
        } else {
            *dst++ = *src++;
        }
    }
    *dst = '\0';
}
```

## Usage

```c
char method[16], path[256], version[16];
char request_line[] = "GET /hello%20world HTTP/1.1\r\n";

if (parse_request_line(request_line, method, path, version) == 0) {
    decode_url(path);
    printf("Method: %s\n", method);    // GET
    printf("Path: %s\n", path);        // hello world
    printf("Version: %s\n", version);  // HTTP/1.1
}
```
